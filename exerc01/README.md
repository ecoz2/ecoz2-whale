# On a 4.5 hour recording

- WAV file: `MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav`

- Selection file: `MARS_20161221_000046_SongSession_16kHz_HPF5HzNorm_labels.csv`.

**NOTE**: None of the WAV files referenced here are committed to this repo.

 
In the following, `$SOURCE_WAV` indicates the path to the source WAV file
above on the machine where the exercises below have been performed.

## Extracting the individual unit instances

Individual WAV files corresponding to the selections extracted as follows:

```
$ ecoz2 sgn extract --segments MARS_20161221_000046_SongSession_16kHz_HPF5HzNorm_labels.csv \
                    --wav ${SOURCE_WAV} \
                    --out-dir data/signals
...
          5470 total instances 
```

The extracted signals under `data/signals/` get organized in subdirectories
corresponding to the associated labels:

```
$ ls data/signals
?   A   B   Bd  Bm  Bmh Bu  C   C1  D   E   E1  EG  F   G   G2  H   I   I2  I3  I4  M   P
```

As an example, instances of the 'B' type are:

```
$ ls data/signals/B
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__10079.092_10080.35.wav
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__10540.822_10543.197.wav
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__1068.8552_1069.205.wav
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__1089.723_1090.6355.wav
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__1102.666_1103.1608.wav
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__12907.783_12909.293.wav
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__15415.037_15417.307.wav
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__2378.6963_2380.534.wav
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__2926.575_2929.6223.wav
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__5067.5444_5070.2764.wav
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__588.77454_591.3191.wav
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__680.14154_680.8046.wav
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__7145.495_7147.0107.wav
```

The name of each extracted file indicates the original WAV file name
and the corresponding begin and end times.

**NOTE**: As we are not interested in the '?' label, we remove those
instances to facilitate subsquent operations:

```
$ rm -rf data/signals/\?
```

## Generating the LPC prediction vector sequences

```
ecoz2 lpc -P 36 -W 45 -O 15 -m 10 -s 0.8 data/signals
```

The `-s 0.8` option splits the generated predictor files into
two categories (TRAIN and TEST) for each class:

```
$ ls data/predictors
TEST  TRAIN

$ ls data/predictors/TRAIN
A  B  Bd Bm Bu C  C1 D  E  E1 F  G  G2 H  I  I2 I3 I4 M  P

$ ls data/predictors/TEST
A  B  Bd Bm Bu C  C1 D  E  E1 F  G  G2 H  I  I2 I3 I4 M  P

$ ls data/predictors/TRAIN/B
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__10079.092_10080.35.prd
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__10540.822_10543.197.prd
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__1068.8552_1069.205.prd
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__1089.723_1090.6355.prd
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__12907.783_12909.293.prd
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__15415.037_15417.307.prd
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__2926.575_2929.6223.prd
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__5067.5444_5070.2764.prd
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__588.77454_591.3191.prd
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__680.14154_680.8046.prd
from_MARS_20161221_000046_SongSession_16kHz_HPF5Hz.wav__7145.495_7147.0107.prd
```

## Codebook generation

Using all TRAIN instances:

```
$ ecoz2 vq learn -P 36 -e 0.0005 data/predictors/TRAIN
num_actual_predictors: 4296

Codebook generation:

396678 training vectors (Îµ=0.0005)
Report: data/codebooks//eps_0.0005.rpt
data/codebooks//eps_0.0005_M_0002.cbook
(12)	DP=0.568047	DDprv=2253669e+3DD=225332D=489570.000150422    e+302
data/codebooks//eps_0.0005_M_0004.cbook
(8)	DP=0.452885	DDprv=179733	DD=179650	0.000465387
data/codebooks//eps_0.0005_M_0008.cbook
(21)	DP=0.357849	DDprv=142001	DD=141951	0.000352577
data/codebooks//eps_0.0005_M_0016.cbook
(14)	DP=0.283411	DDprv=112473	DD=112423	0.000441609
data/codebooks//eps_0.0005_M_0032.cbook
(15)	DP=0.236244	DDprv=93758.2	DD=93712.7	0.000484804
data/codebooks//eps_0.0005_M_0064.cbook
(15)	DP=0.204155	DDprv=81017.8	DD=80983.8	0.000419916
data/codebooks//eps_0.0005_M_0128.cbook
(18)	DP=0.179191	DDprv=71115.7	DD=71081.1	0.000486512
data/codebooks//eps_0.0005_M_0256.cbook
(19)	DP=0.159744	DDprv=63396.7	DD=63366.8	0.000471613
data/codebooks//eps_0.0005_M_0512.cbook
(15)	DP=0.145311	DDprv=57666.3	DD=57641.6	0.000429173
data/codebooks//eps_0.0005_M_1024.cbook
(14)	DP=0.133171	DDprv=52849.5	DD=52826.5	0.000444535
data/codebooks//eps_0.0005_M_2048.cbook
(14)	DP=0.122283	DDprv=48530.7	DD=48507.7	0.000489385
```

## Vector quantization

Quantize all TRAIN and TEST vectors using the 2048-codeword codebook:

```
$ ecoz2 vq quantize --codebook data/codebooks/eps_0.0005_M_2048.cbook data/predictors/TRAIN
...
total: 4296 sequences; dprm total = 0.120606

$ ecoz2 vq quantize --codebook data/codebooks/eps_0.0005_M_2048.cbook data/predictors/TEST
...
total: 1060 sequences; dprm total = 0.131448
```

Resulting sequences get generated under `data/sequences/{TRAIN,TEST}`.

## HMM training

For each class (label), an HMM model is trained using the corresponding
training sequences: 

```
for class in `ls data/sequences/TRAIN/M2048/`; do 
  ecoz2 hmm learn -N 64 data/sequences/TRAIN/M2048/$class &
done
```

HMM models generated under `data/hmms/N64__M2048_t3__a0.1_I30/`.

## HMM classification

### On training sequences:

```
$ ecoz2 hmm classify --models data/hmms/N64__M2048_t3__a0.1_I30 --sequences data/sequences/TRAIN/M2048
number of HMM models: 20  number of sequences: 4296
show_ranked = false

Loading models:
 0: data/hmms/N64__M2048_t3__a0.1_I30/A.hmm
 1: data/hmms/N64__M2048_t3__a0.1_I30/B.hmm
 2: data/hmms/N64__M2048_t3__a0.1_I30/Bd.hmm
 3: data/hmms/N64__M2048_t3__a0.1_I30/Bm.hmm
 4: data/hmms/N64__M2048_t3__a0.1_I30/Bu.hmm
 5: data/hmms/N64__M2048_t3__a0.1_I30/C.hmm
 6: data/hmms/N64__M2048_t3__a0.1_I30/C1.hmm
 7: data/hmms/N64__M2048_t3__a0.1_I30/D.hmm
 8: data/hmms/N64__M2048_t3__a0.1_I30/E.hmm
 9: data/hmms/N64__M2048_t3__a0.1_I30/E1.hmm
10: data/hmms/N64__M2048_t3__a0.1_I30/F.hmm
11: data/hmms/N64__M2048_t3__a0.1_I30/G.hmm
12: data/hmms/N64__M2048_t3__a0.1_I30/G2.hmm
13: data/hmms/N64__M2048_t3__a0.1_I30/H.hmm
14: data/hmms/N64__M2048_t3__a0.1_I30/I.hmm
15: data/hmms/N64__M2048_t3__a0.1_I30/I2.hmm
16: data/hmms/N64__M2048_t3__a0.1_I30/I3.hmm
17: data/hmms/N64__M2048_t3__a0.1_I30/I4.hmm
18: data/hmms/N64__M2048_t3__a0.1_I30/M.hmm
19: data/hmms/N64__M2048_t3__a0.1_I30/P.hmm

***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************_********_**_*********************************_*_******************************************************************************************************************_***********************_*************************_**********************************************************************************************************************_*************************************************************************************************************************************************************************************************************************************************************************************************************_******************************************************************************************************************************************_*********************************************************************************************_************_*****************************************_********************************************__*_**************************************************************************************_*****__________**______*******_*****_****_*****_*************_********************************************************************_**************************************___*****_*******_***__****************************************************************************************************_************************************************************************************************************************************_**************************************************************************************************_*********__________________*__________*__***_*****************************_*******************************************************_*******************************************___**************************************************************_*********************************************************_***************************_____****************************************************************************__********************************************************************************************************************_***********************************************************************************************************************************************************************************************************************************************__*************_****************************************__*************************************************************************************************************************************************************************************************************************_*************************_******************************************************************************_********************************************************_**_***********************************************************************************_****************************************************************************************************_***************_*******__***************************************************___***_*****_**********************************************************************************************************************************************************************_**_**__*_***************__**___*****_**_***************_**__***_**__************************************************************************************************************************************************************************************************************_*__******************************************************__****************************____*********************************************************************************************************************************************************************************************

     Confusion matrix:
            0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19     tests   errors

   A   0  410   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0      410       0
   B   1    0  11   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0       11       0
  Bd   2    0   0  41   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0       41       0
  Bm   3    2   0   0 477   2   0   0   0   0   0   0   0   0   0   0   4   1   0   0   0      486       9
  Bu   4    0   0   0   0  35   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0       35       0
   C   5    0   0   0   0   0 437   0   0   0   0   3   0   0   0   1   0   0   0   0   0      441       4
  C1   6    0   0   0   0   0   0  13   0   0   0   0   0   0   0   0   0   0   0   0   0       13       0
   D   7    0   0   0   0   0   2   0 136   0   0   2   0   0   0   1   0   0   0   0   0      141       5
   E   8    0   0   0   0   0   1   0   0 508   0   0   0   0   0  49  13   0   0   0   0      571      63
  E1   9    0   0   0   0   0   0   0   0   0  22   0   0   0   0   0   0   0   0   0   0       22       0
   F  10    0   0   0   0   0   6   0   1   1   0 261   0   2   0   1   0   0   0   0   1      273      12
   G  11    0   0   0   0   0   0   0   0   0   0   0  59   0   0   2   0   0   0   0   0       61       2
  G2  12    0   0   0   0   0   0   0   0   1   0   0   0 245   0   0   0   0   0   0   0      246       1
   H  13    0   0   0   0   0   0   0   0   0   0   0   0   2 111   0   0   0   0   0   0      113       2
   I  14    0   0   0   0   0   0   0   0   0   0   0   0   0   0 372   5   0   0   0   0      377       5
  I2  15    0   0   0   2   0   0   0   0   1   0   0   0   0   0  28 541   0   0   0   0      572      31
  I3  16    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   3 257   0   0   0      260       3
  I4  17    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   1   5  31   0   0       37       6
   M  18    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0  49   0       49       0
   P  19    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0 137      137       0

     class     accuracy    tests      candidate order
   A     0      100.00%   410        410   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   B     1      100.00%    11         11   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
  Bd     2      100.00%    41         41   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
  Bm     3       98.15%   486        477   7   1   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
  Bu     4      100.00%    35         35   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   C     5       99.09%   441        437   4   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
  C1     6      100.00%    13         13   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   D     7       96.45%   141        136   4   0   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   E     8       88.97%   571        508  51  10   2   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
  E1     9      100.00%    22         22   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   F    10       95.60%   273        261   6   4   1   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   G    11       96.72%    61         59   0   1   0   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
  G2    12       99.59%   246        245   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   H    13       98.23%   113        111   0   0   1   0   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   I    14       98.67%   377        372   4   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
  I2    15       94.58%   572        541  31   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
  I3    16       98.85%   260        257   3   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
  I4    17       83.78%    37         31   5   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   M    18      100.00%    49         49   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   P    19      100.00%   137        137   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0

       TOTAL     96.67%   4296        4153 116  18   6   2   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0
```


### On test sequences:

```
$ ecoz2 hmm classify --models data/hmms/N64__M2048_t3__a0.1_I30 --sequences data/sequences/TEST/M2048
number of HMM models: 20  number of sequences: 1060
show_ranked = false

Loading models:
 0: data/hmms/N64__M2048_t3__a0.1_I30/A.hmm
 1: data/hmms/N64__M2048_t3__a0.1_I30/B.hmm
 2: data/hmms/N64__M2048_t3__a0.1_I30/Bd.hmm
 3: data/hmms/N64__M2048_t3__a0.1_I30/Bm.hmm
 4: data/hmms/N64__M2048_t3__a0.1_I30/Bu.hmm
 5: data/hmms/N64__M2048_t3__a0.1_I30/C.hmm
 6: data/hmms/N64__M2048_t3__a0.1_I30/C1.hmm
 7: data/hmms/N64__M2048_t3__a0.1_I30/D.hmm
 8: data/hmms/N64__M2048_t3__a0.1_I30/E.hmm
 9: data/hmms/N64__M2048_t3__a0.1_I30/E1.hmm
10: data/hmms/N64__M2048_t3__a0.1_I30/F.hmm
11: data/hmms/N64__M2048_t3__a0.1_I30/G.hmm
12: data/hmms/N64__M2048_t3__a0.1_I30/G2.hmm
13: data/hmms/N64__M2048_t3__a0.1_I30/H.hmm
14: data/hmms/N64__M2048_t3__a0.1_I30/I.hmm
15: data/hmms/N64__M2048_t3__a0.1_I30/I2.hmm
16: data/hmms/N64__M2048_t3__a0.1_I30/I3.hmm
17: data/hmms/N64__M2048_t3__a0.1_I30/I4.hmm
18: data/hmms/N64__M2048_t3__a0.1_I30/M.hmm
19: data/hmms/N64__M2048_t3__a0.1_I30/P.hmm

*********************************************************************************************_*_******_____**_____*******_*_*__*__*******__*****************__*****__***__**__*_*_***___************_*****__********_*************__****__**_**_*__*******_****_**__*************__****_**_******_******************************************__****_**_****_****_*******_**_*_****_**_*__********_**____*__***__***_******_**__**_*_**___*_**_*_*_*_********************__*****__************_*_********___*_**_**_****__**_**__**_***_**______________**********************_********_****_******_**************_*******____******___**__***_************__**_******************_*_*******_*__*_**___***_************__*_****_******____**______*_____***_***___*__*_********__***_************__****_______*********************_***_*************************************_****_*****_*******_****************************_***********************************_**__**__*_________**__*_*****_*__********_*****____***_**__**_******__*_***_**___**_*____**________*_****_**__**_******__*_***_**___

     Confusion matrix:
            0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19     tests   errors

   A   0  100   0   0   0   0   0   0   0   0   0   0   0   0   0   2   0   0   0   0   0      102       2
   B   1    0   0   0   2   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0        2       2
  Bd   2    0   0   2   4   1   0   0   0   0   0   0   0   0   0   1   1   0   0   0   0        9       7
  Bm   3    3   0   1  91   3   0   0   1   1   0   0   0   1   0   3  15   2   0   0   0      121      30
  Bu   4    0   0   0   3   5   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0        8       3
   C   5    0   0   0   0   0  94   0   0   0   0   8   0   1   0   3   3   0   0   0   0      109      15
  C1   6    0   0   0   0   0   0   2   0   0   0   1   0   0   0   0   0   0   0   0   0        3       1
   D   7    0   0   0   0   0   2   0  25   3   0   2   0   0   0   2   0   0   0   0   0       34       9
   E   8    1   0   0   0   0   2   0   0  92   0   0   0   1   1  22  23   0   0   0   0      142      50
  E1   9    0   0   0   0   0   0   0   0   1   1   0   0   2   0   0   1   0   0   0   0        5       4
   F  10    0   0   0   0   0   3   0   2   0   0  60   0   1   0   0   0   0   0   1   0       67       7
   G  11    0   0   0   0   0   0   0   0   3   0   1   8   0   0   2   1   0   0   0   0       15       7
  G2  12    0   0   0   0   0   1   0   0   3   0   0   0  48   0   3   6   0   0   0   0       61      13
   H  13    0   0   0   0   0   0   0   0   1   0   0   0   0  23   0   3   0   0   0   1       28       5
   I  14    0   0   0   0   0   0   0   0   6   0   0   0   0   0  60  28   0   0   0   0       94      34
  I2  15    0   0   0   1   0   0   0   0   3   0   0   0   0   0  11 125   2   0   0   0      142      17
  I3  16    0   0   0   0   0   0   0   0   0   0   0   0   0   0   0  23  41   0   0   0       64      23
  I4  17    1   0   0   1   0   0   0   0   0   0   0   0   0   0   0   3   1   3   0   0        9       6
   M  18    0   0   0   2   0   0   0   1   1   0   0   0   0   0   0   5   0   0   2   0       11       9
   P  19    0   0   0   0   0   0   0   0   3   0   0   0   1   0   7   2   0   0   0  21       34      13

     class     accuracy    tests      candidate order
   A     0       98.04%   102        100   1   0   0   0   0   0   1   0   0   0   0   0   0   0   0   0   0   0   0
   B     1        0.00%     2          0   0   0   1   0   0   0   0   0   0   0   0   0   0   1   0   0   0   0   0
  Bd     2       22.22%     9          2   2   2   0   1   0   0   0   0   1   0   0   0   0   1   0   0   0   0   0
  Bm     3       75.21%   121         91  17   5   2   2   0   1   2   0   0   0   1   0   0   0   0   0   0   0   0
  Bu     4       62.50%     8          5   3   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   C     5       86.24%   109         94  10   2   2   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
  C1     6       66.67%     3          2   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   D     7       73.53%    34         25   5   2   0   0   0   2   0   0   0   0   0   0   0   0   0   0   0   0   0
   E     8       64.79%   142         92  28  16   5   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
  E1     9       20.00%     5          1   1   1   0   0   1   0   0   0   1   0   0   0   0   0   0   0   0   0   0
   F    10       89.55%    67         60   3   2   0   2   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   G    11       53.33%    15          8   0   2   0   0   0   1   1   0   1   1   0   1   0   0   0   0   0   0   0
  G2    12       78.69%    61         48   9   2   2   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   H    13       82.14%    28         23   1   1   1   1   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0
   I    14       63.83%    94         60  20  13   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
  I2    15       88.03%   142        125  16   0   0   0   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0
  I3    16       64.06%    64         41   9   4   5   3   1   1   0   0   0   0   0   0   0   0   0   0   0   0   0
  I4    17       33.33%     9          3   1   1   1   0   1   0   1   0   1   0   0   0   0   0   0   0   0   0   0
   M    18       18.18%    11          2   2   2   0   3   0   1   0   0   1   0   0   0   0   0   0   0   0   0   0
   P    19       61.76%    34         21   5   5   1   0   2   0   0   0   0   0   0   0   0   0   0   0   0   0   0

       TOTAL     75.75%   1060        803 134  60  21  14   7   6   5   0   5   1   1   1   0   2   0   0   0   0   0
```

# Training parameter variations

For various values of `$N` and `$M`,
as indicated in [summary.csv](summary.csv),
HMM models trained and evaluated as follows
(see [variations.sh](variations.sh)).

    for class in `ls data/sequences/TRAIN/M${M}/`; do
      ecoz2 hmm learn -N ${N} data/sequences/TRAIN/M${M}/$class &
    done

Note, the default `-a` parameter value is `0.3`, which gets reflected
in the resulting HMM model files as shown below.

Classification done as follows:

- On training data:
    
        ecoz2 hmm classify --models data/hmms/N${N}__M${M}_t3__a0.3 --sequences data/sequences/TRAIN/M${M}
    
- On test data:
    
        ecoz2 hmm classify --models data/hmms/N${N}__M${M}_t3__a0.3 --sequences data/sequences/TEST/M${M}
